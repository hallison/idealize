<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="description" content=""/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Prodam - <%=@page[:title]%></title>

  <!-- Fallback to homescreen for Chrome <39 on Android -->
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="application-name" content="Material Design Lite"/>
  <link rel="icon" sizes="192x192" href=""/>

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
  <meta name="apple-mobile-web-app-title" content=""/>

  <link rel="apple-touch-icon" href="<%=path_to '/img/ios-desktop.png'%>"/>
  <link rel="shortcut icon" href="<%=path_to '/img/favicon.gif'%>"/>

  <!-- Page styles -->
  <link rel="stylesheet" href="<%=path_to '/src/dialog-polyfill/dialog-polyfill.css'%>"/>
  <link rel="stylesheet" href="<%=path_to '/src/material-design-lite/material.min.css'%>"/>
  <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.deep_purple-orange.min.css"/>
  <link rel="stylesheet" href="<%=path_to '/css/prodam.css'%>"/>
  <%=yield_content :stylesheet%>

  <!-- Fonts -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en"/>
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>

  <script src="<%=path_to '/src/dialog-polyfill/dialog-polyfill.js'%>"></script>
</head>

<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--no-desktop-drawer-button">
    <header class="prd-layout__header mdl-layout__header">
      <div class="mdl-layout__header-row">
        <div class="mdl-layout--small-screen-only">
          <span class="mdl-layout-title prd-layout-title">
            <i class="material-icons"><%=@page[:icon]%></i>
            <span><%=@page[:title]%></span>
          </span>
        </div>

        <div class="mdl-layout--large-screen-only">
          <span class="mdl-layout-title prd-layout-icon-expanded">
            <a href="<%=path_to :home%>">
              <img src="<%=path_to '/img/brand-colored.svg'%>" alt="Idealize" title="Idealize"/>
            </a>
          </span>
        </div>

        <div class="mdl-layout-spacer"></div>

        <nav class="prd-navigation mdl-navigation">
          <form action="<%=path_to :ideias, :pesquisa%>" method="get">
            <div class="prd-searchbox mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right">
              <label id="toolbar-search" class="mdl-button mdl-button--icon mdl-js-button" for="ideias-termo-pesquisa">
                <i class="material-icons">search</i>
              </label>
              <div class="mdl-textfield__expandable-holder">
                <input class="mdl-textfield__input" type="text" name="termo" id="ideias-termo-pesquisa" placeholder="Pesquise por ideias ...">
                <span class="mdl-tooltip" for="toolbar-search">Procure por ideias publicadas</span>
              </div>
            </div>
          </form>
        </nav>

        <nav class="prd-navigation mdl-navigation mdl-layout--large-screen-only">
          <%sections.select { |id, section| section[:navigation].include? 'header' }.each do |id, section|%>
            <%is_active = 'is-active' if @page[:url_path] == section[:url_path]%>
            <a class="mdl-navigation__link prd-navigation__link <%=is_active%>" href="<%=path_to section[:url_path]%>">
              <%=section[:title]%>
            </a>
          <%end%>
        </nav>

        <%if authenticated?%>
          <button id="account-options" class="mdl-button mdl-button--fab mdl-button--mini-fab mdl-js-button">
            <img src="<%=gravatar usuario_email, size: '40', default: :mm%>"/>
          </button>

          <div class="mdl-menu mdl-menu--bottom-right mdl-js-menu" for="account-options">
            <a href="<%=path_to :painel%>" class="mdl-menu__item">Painel</a>
            <a href="<%=path_to :conta%>" class="mdl-menu__item">Conta</a>
            <a href="<%=path_to :conta, :sair%>" class="mdl-menu__item">Sair</a>
          </div>
        <%else%>
          <nav class="prd-navigation mdl-navigation">
            <a href="#login" class="prd-navigation__link mdl-navigation__link mdl-js-ripple-effect mdl-button--open-dialog">
              Login
            </a>
            <a href="<%=path_to :usuarios, :novo%>" class="mdl-button mdl-button--raised mdl-color--accent mdl-js-button mdl-js-ripple-effect mdl-button--open-dialog">
              Cadastro
            </a>
          </nav>
        <%end%>
      </div><!--/.mdl-layout__header-row-->
    </header>

    <div class="mdl-layout__drawer prd-layout__drawer">
      <span class="mdl-layout-title"></span>
      <a href="<%=path_to :home%>"><img src="<%=path_to '/img/brand-colored.svg'%>" class="prd-drawer__brand"/></a>
      <nav class="mdl-navigation prd-navigation">
      <%sections.select { |id, section| section[:navigation].include? 'header' }.each do |id, section|%>
        <%is_active = 'is-active' if @page[:url_path] == section[:url_path]%>
        <a class="mdl-navigation__link prd-navigation__link <%=is_active%>" href="<%=path_to section[:url_path]%>">
          <i class="material-icons" role="presentation"><%=section[:icon]%></i>
          <%=section[:title]%>
        </a>
      <%end%>
      </nav>
      <div class="mdl-layout-spacer"></div>
      <nav class="mdl-navigation prd-navigation">
        <a class="mdl-navigation__link prd-navigation__link" href="<%=path_to :ajuda%>"><i class="material-icons" role="presentation">help</i>Ajuda</a>
      </nav>
      <small class="mdl-color--grey-200 mdl-typography--text-center">
        <a href="<%=path_to :versao%>" style="text-decoration: none; color: inherit;"><%=version_info%></a>
      </small>
    </div>

    <main class="mdl-layout__content">
      <div class="prd-ribbon"></div>
      <div class="prd-content prd-content--with-ribbon prd-content--with-background">
        <%=yield%>
      </div>

      <footer class="prd-footer mdl-mini-footer">
        <div class="mdl-mini-footer__left-section mdl-cell--4-col-desktop mdl-cell--2-col-tablet mdl-cell--4-phone">
          <p>Estamos melhorando a página para receber suas ideias.</p>
        </div>
        <div class="mdl-mini-footer__center-section mdl-typography--text-center mdl-cell--4-col-desktop mdl-cell--4-col-tablet mdl-cell--4-phone">
          <span><%=Date.today.year%> &copy; PRODAM - Processamento de Dados Amazonas S/A</span><br/>
          <small><a href="<%=path_to :versao%>" style="text-decoration: none"><%=version_info%></a></small>
          <%if authenticated?%>
            <a id="fab" href="<%=@fab[:url]%>" class="prd-footer__button-add mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--fab mdl-button--colored mdl-shadow--4dp">
              <i class="material-icons">edit</i>
            </a>
            <span class="mdl-tooltip mdl-tooltip--top" for="fab"><%=@fab[:tooltip]%></span>
          <%end%>
        </div>
        <div class="mdl-mini-footer__right-section mdl-cell--4-col-desktop mdl-cell--2-col-tablet mdl-cell--4-phone"></div>
      </footer>
    </main>
  </div>
  <%unless authenticated?%>
  <dialog class="mdl-dialog">
    <form action="<%=path_to :conta, :acessar%>" method="post">
      <div class="mdl-dialog__content mdl-grid mdl-grid--no-spacing">
        <img src="<%=path_to '/img/brand-colored.svg'%>" class="mdl-cell mdl-cell--12-col prd-brand"/>
        <div class="mdl-cell mdl-cell--12-col mdl-typography--text-right">
          <small><%=version_info%></small>
        </div>
        <div class="mdl-cell mdl-cell--12-col mdl-textfield mdl-textfield--floating-label mdl-js-textfield">
          <label for="usuario" class="mdl-textfield__label">Usuário</label>
          <input type="text" id="usuario" name="usuario[nome_usuario]" class="mdl-textfield__input"/>
        </div>
        <div class="mdl-cell mdl-cell--12-col mdl-textfield mdl-textfield--floating-label mdl-js-textfield">
          <label for="senha" class="mdl-textfield__label">Password</label>
          <input type="password" id="senha" name="usuario[senha]" class="mdl-textfield__input"/>
        </div>
        <div class="mdl-cell mdl-cell--12-col">
          <input type="hidden" name="url" value="<%=request.url%>"/>
          <button type="submit" class="mdl-button mdl-button--raised mdl-js-button mdl-js-ripple-effect">
            Acessar
          </button>
          <button type="button" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--close-dialog">
            Cancelar
          </button>
        </div>
      </div>
    </form>
  </dialog>
  <script src="<%=path_to '/js/dialog.js'%>"></script>
  <%else%>
    <%=yield_content :dialog%>
  <%end%>
  <script src="<%=path_to '/src/material-design-lite/material.min.js'%>"></script>
  <%if message[:text]%>
    <div id="notification" aria-live="assertive" aria-atomic="true" aria-relevant="text" class="mdl-snackbar mdl-js-snackbar prd-color--<%=message[:level]%>">
      <div class="mdl-snackbar__text"></div>
      <button type="button" class="mdl-snackbar__action"></button>
    </div>

    <script src="<%=path_to '/js/ready.js'%>"></script>
    <script>
      ready(function () {
        var notification = document.querySelector('#notification');
        var notificationConfig = {
          message: '<%=message[:text]%>',
          actionHandler: function(event) {
          },
          actionText: 'Ok',
          timeout: 5000
        };
        notification.MaterialSnackbar.showSnackbar(notificationConfig);
      });

      // setTimeout(function() {
      // }, 500);
    </script>
    <%message.update text: nil%>
  <%end%>
  <%=yield_content :script%>
</body>
</html>
